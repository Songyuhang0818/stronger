---
title: 三款常用组件
author: KaiHuWeb
date: 2020-07-01
tags:
  - 组件
---

## 保险协议组件

- 维护两个 props，`iframeSrc`、`title`，分别表示 iframe 的地址和协议的地址名
- 需要父组件维护一个关闭/开启的状态，比如`showAgreement`，在组件加上关闭按钮事件`@close-agreement`

```vue
<template>
  <div>
    <div class="mask"></div>
    <div class="agreement">
      <div class="agreement-title">
        {{ title }}
        <span class="agreement-close" @click="closeAgreement">X</span>
      </div>
      <div class="agreement-iframe">
        <iframe :src="iframeSrc" frameborder="0"></iframe>
      </div>
    </div>
  </div>
</template>

<script>
import { canMove } from '@/utils';

export default {
  props: {
    iframeSrc: {
      type: String,
      default: '',
    },
    title: {
      type: String,
      default: '',
    },
  },
  methods: {
    // 关闭按钮事件
    closeAgreement() {
      this.$emit('close-agreement');
    },
    touchmoveForbidden(e) {
      e.preventDefault();
    },
  },
  created() {
    const mask = document.querySelector('.mask');
    canMove(false, mask);
  },
  beforeDestroy() {
    const mask = document.querySelector('.mask');
    canMove(true, mask);
  },
};
</script>

<style lang="scss" scoped>
.mask {
  position: fixed;
  background-color: rgba(0, 0, 0, 0.7);
  top: 0;
  width: 100vw;
  height: 100vh;
  z-index: 1;
  overflow: hidden;
  box-sizing: border-box;
  padding-top: 10vh;
}

.agreement {
  position: fixed;
  width: 100vw;
  height: 90vh;
  bottom: 0;
  animation-duration: 0.5s;
  animation-fill-mode: both;
  animation-name: show;
  background-color: #fff;
  z-index: 2;

  &-close {
    position: absolute;
    top: 0.21333rem;
    right: 0.21333rem;
    font-size: 0.4rem;
  }

  &-title {
    position: relative;
    height: 1.6rem;
    color: #323232;
    font-size: 0.4267rem;
    font-weight: 700;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  &-iframe {
    width: 100%;
    height: 90%;
    overflow: auto;
    -webkit-overflow-scrolling: touch;

    iframe {
      width: 100%;
      height: 100%;
    }
  }
}

@keyframes show {
  from {
    opacity: 0;
    transform: translate3d(0, 100%, 0);
  }

  to {
    opacity: 1;
    transform: translateZ(0);
  }
}
</style>
```

## toast 组件

- 组件功能比较简单，一个展示 3s 就消失的 toast
- 下面提供了全局的安装方法，在 main.js 里面引入 toast.ts，`Vue.use(toast)`就可以了

```vue
<template>
  <div class="toast">
    <p>
      {{ text }}
    </p>
  </div>
</template>

<script lang="ts">
import { Vue, Component, Prop } from 'vue-property-decorator';

@Component
export default class Toast extends Vue {
  text: string = '';
}
</script>

<style lang="scss" scoped>
.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  z-index: 10;
  transform: translate(-50%, -50%);
  width: 10rem;
  margin: 0 auto;
  margin-top: -0.66667rem;
  text-align: center;
  background: 0 0;

  p {
    display: inline-block;
    line-height: 0.8rem;
    text-align: left;
    color: #fff;
    font-size: 30px;
    border-radius: 7px;
    padding: 0.4rem;
    background: rgba(0, 0, 0, 0.8);
    max-width: 70%;
    word-wrap: break-word;
  }
}
</style>
```

```ts
import Toast from '@/components/toast.vue';

export default {
  install(Vue: any) {
    Vue.prototype.$toast = (text: string) => {
      const ToastConstrucor = Vue.extend(Toast);
      const toast = new ToastConstrucor({
        el: document.createElement('div'),
      });
      toast.text = text;
      const root = document.querySelector('#app') as HTMLElement;
      root.appendChild(toast.$el);
      setTimeout(() => {
        toast.$el.remove();
      }, 3000);
    };
  },
};
```

## 保险的 loading 组件

- 这个写法以来 zepto 或者 jq，可以替换为原生
- 需要在全局注入样式，或者可以换一个写法，把样式封装和行为封装到.vue 文件，再使用和 toast 一样的方式，引入全局

```js
import $ from 'zepto';
import Vue from 'vue';

const Loading = {
  install(Vue) {
    Vue.prototype.$loading = (show = true) => {
      const $app = $('#app');
      if (show) {
        $app.append('<div class="loading"></div>');
      } else {
        $('.loading').remove();
      }
    };
  },
};

Vue.use(Loading);
```

```scss
@keyframes loading-rotate {
  0% {
    -webkit-transform: rotate(0deg) scale(1);
    transform: rotate(0deg) scale(1);
  }
  50% {
    -webkit-transform: rotate(180deg) scale(0.6);
    transform: rotate(180deg) scale(0.6);
  }
  100% {
    -webkit-transform: rotate(360deg) scale(1);
    transform: rotate(360deg) scale(1);
  }
}

.loading {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: #fff;
  z-index: 10;

  @mixin common($size) {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: $size;
    height: $size;
    margin-top: -$size / 2;
    margin-left: -$size / 2;
    border-width: 2px;
    border-color: #ed5565 transparent;
    border-style: solid;
    border-radius: 100%;
    animation: loading-rotate 1s 0s ease-in-out infinite;
    z-index: 12;
  }

  &::before {
    @include common(35px);
  }

  &::after {
    @include common(15px);
    animation-direction: reverse;
  }
}
```
